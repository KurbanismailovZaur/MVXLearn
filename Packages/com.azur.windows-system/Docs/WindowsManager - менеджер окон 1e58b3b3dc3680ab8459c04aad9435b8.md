# WindowsManager - менеджер окон

Помимо того, что вы можете работать с отдельными окнами самостоятельно, вы также можете использовать менеджера окон для автоматизации переключений между ними.

Добавьте скрипт `WindowsManager` на любой объект в вашей сцене (обычно на самый родительский канвас).

![image.png](image%204.png)

### `DefaultWindowsParent`

Это игровой объект в котором по умолчанию будут создаваться новые окна.

### `DefaultWindowActivationAnimation` и `DefaultWindowDeactivationAnimation`

Это анимации активации и деактивации окон, которые будут использоваться по умолчанию, если вы не указали анимацию через код. Если оставить эти поля не заданными, то будут использоваться анимации по умолчанию, которые заданы в самих окнах.

### `DefaultWindowsSwitchingStrategy`

Представляет стратегию переключения окон, например когда вы из кода “говорите” что вам надо заменить последние три открытых окна на одно другое, то вы можете указать объект типы [SwitchingStrategy](SwitchingStrategy%20-%20%D1%82%D0%B8%D0%BF%20%D0%BF%D0%B5%D1%80%D0%B5%D0%BA%D0%BB%D1%8E%D1%87%D0%B5%D0%BD%D0%B8%D1%8F%20%D0%BE%D0%BA%D0%BE%D0%BD%201ea8b3b3dc368069bd0cdbcef809fb70.md), благодаря которому менеджер заменит одни окна другими.

### `CanvasSortOrderOffset`

Определяет смещение для `SortOrder` у канваса. Всякий раз когда менеджер будет активировать окно, он установит определенное значение в `Canvas.sortOrder` этого окна. Это значение вычисляется по формуле: `CanvasSortOrderOffset` + `windowIndexInActivatedList`. Где:

- `CanvasSortOrderOffset` - это смещение которые вы задаете у менеджера.
- `windowIndexInActivatedList` - это индекс окна в списке активированных окон.

### `ActivatedWindows`

Представляет список активированных в данный момент окон. Последний элемент этого списка - это последнее активированное окно.

### `CachedWindows`

Представляет список кешированных окон независимо от состояния активации.

### `PrefabWindows`

Представляет список префабов окон. Эти префабы окон будут использоваться в момент когда кешированных деактивированных окон нет и нужно создать и кешировать новое.

# Настройка заранее существующих окон

Вы можете создать окна заранее и расположить их в иерархии как вам угодно, однако если окно представлено классом `WindowWithCanvasGroup`, то вы сами должны позаботиться о том, чтобы его `CanvasGroup` имел нужные настройки для актуального состояния. 

Вы также должны позаботиться о том, чтобы все заранее существующие окна были добавлены в список  `CachedWindows` и о том, чтобы все заранее активированные окна были в списке `ActivatedWindows`.

![image.png](image%205.png)

# API работы с менеджером окон

Используйте следующие свойства и методы для работы с менеджером окон…

## `IsInTransition`

Вернет `true`, если в данный момент менеджер занят активацией/деактивацией/переключением окон. 

## `CanvasSortOrderOffset`

Вернет значение смещения для `sortOrder` у отображаемых окон. Всякий раз когда менеджер будет отображать окно, в `canvas.sortOrder` этого окна запишется значение `CanvasSortOrderOffset` + позиция окна в списке `activatedWindows`. 

## `ActivatedWindows`

Вернет readonly-список активных окон.

## `CurrentWindow`

Вернет текущее окно (последнее в списке `activatedWindows`).

## `Instantiate(...)`

Это статический метод, который создаст новый менеджер и заполнит его переданными значениями. Полезно когда вам надо создать менеджер окна динамически из кода.

## `GetActivatedWindow<TWindow>(...)`

Вернет первое с конца окно типа `TWindow` в списке `activatedWindows`. 

Имеет перегрузку принимающую предикат.

## `GetActivatedWindows(...)`

Вернет все окна типа `TWindow` в списке `activatedWindows`. 

Имеет перегрузку принимающую предикат.

## `CacheNewWindow<TWindow>()`

Инстанциирует и кеширует новое окно типа `TWindow` независимо от того есть ли такое окно среди уже кешированных. Поиск префаба для инстанциации будет происходить в списке `prefabWindows`, взят будет первый подходящий по типу префаб. 

## `GetCachedWindow<TWindow>(...)`

Вернет первое кешированное окно типа `TWindow`, при этом состояние окна никак не учитывается, оно может быть уже активированным. 

Имеется перегрузка принимающая предикат, которую вы можете использовать, чтобы найти кешированное окно типа `TWindow` и при этом чтобы оно не было активно. 

## `GetOrCreateCachedWindow<TWindow>(...)`

Попробует найти окно типа `TWindow` среди кешированных (без учета состояния окна) и вернуть его, если не найдет тогда использует метод `CacheNewWindow` чтобы создать и кешировать новое окно типа `TWindow`, а затем вернет его. 

Имеет перегрузку которая принимает предикат.

## `ActivateWindow<TWindow>(...)`

Активирует окно типа `TWindow`. Поиск окна будет проводиться среди кешированных и одновременно деактивированных по типу `TWindow`. Если окно не будет найдено, то будет использован метод `CacheNewWindow` чтобы создать и кешировать новое окно типа `TWindow`, а затем активирует его.

Имеет опциональные параметры:

- `useUnscaledTime` - нужно ли в анимации активации окна учитывать независимое от `Time.timeScale` время?
- `windowActivationAnimation` - анимация активации окна. Если `null`, то будет использоваться `DefaultWindowActivationAnimation`.

## `DeactivateWindowsUpTo<TWindow>(...)`

Деактивирует (с конца) все окна в списке активированных до окна с указанным типом `TWindow`.

Имеет опциональные параметры:

- `deactivateTargetWindow` - нужно ли деактивировать целевое окно (то которое совпало с типом `TWindow`)?
- `windowIndexFromEnd` - до какого окна типа `TWindow` по счету нужно деактивировать, если таких окон несколько? По умолчанию имеет значение 0, что означает `первое с конца`. Например, если стек активных окон такой: `A` → `B` → `C` → `B` → `D`, то при вызове `DeactivateWindowsUpTo<B>(windowIndexFromEnd:0)` останутся активными `A` → `B` → `C` → `B`, а при вызове `DeactivateWindowsUpTo<B>(windowIndexFromEnd:1)` останутся активными `A` → `B`.
- `useUnscaledTime` - нужно ли в анимации активации окна учитывать независимое от `Time.timeScale` время?
- `windowsSwitchingStrategy` - стратегия переключения окон. В данном методе используется как стратегия деактивации окон. Если не указана, то используется заданная в менеджере окон.
- `windowDeactivationAnimation` - анимация деактивации окон. Если не указана, то используется заданная в менеджере окон.

## `DeactivateCurrentWindow(...)`

Деактивирует последнее активированное окно.

Имеет опциональные параметры:

- `useUnscaledTime` - нужно ли в анимации активации окна учитывать независимое от `Time.timeScale` время?
- `windowDeactivationAnimation` - анимация деактивации окон. Если не указана, то используется заданная в менеджере окон.

## `DeactivateAllWindows(...)`

Деактивирует все активные окна.

Имеет опциональные параметры:

- `useUnscaledTime` - нужно ли в анимации активации окна учитывать независимое от `Time.timeScale` время?
- `windowDeactivationAnimation` - анимация деактивации окон. Если не указана, то используется заданная в менеджере окон.

## `SwitchWindows<TDeactivationWindow, TActivationWindow>()`

Деактивирует (с конца) все окна в списке активированных до окна с указанным типом `TDeactivationWindow` и активирует окно типа `TActivationWindow`.

Имеет опциональные параметры:

- `useUnscaledTime` - нужно ли в анимации активации окна учитывать независимое от `Time.timeScale` время?
- `windowIndexFromEnd` - до какого окна типа `TWindow` по счету нужно деактивировать, если таких окон несколько? По умолчанию имеет значение 0, что означает `первое с конца`. Например, если стек активных окон такой: `A` → `B` → `C` → `B` → `D`, то при вызове `DeactivateWindowsUpTo<B>(windowIndexFromEnd:0)` останутся активными `A` → `B` → `C` → `B`, а при вызове `DeactivateWindowsUpTo<B>(windowIndexFromEnd:1)` останутся активными `A` → `B`.
- `windowsSwitchingStrategy` - стратегия переключения окон. В данном методе используется как стратегия деактивации окон. Если не указана, то используется заданная в менеджере окон.
- `windowDeactivationAnimation` - анимация деактивации окон. Если не указана, то используется заданная в менеджере окон.
- `windowActivationAnimation` - анимация активации окна. Если `null`, то будет использоваться `DefaultWindowActivationAnimation`.

## `SetWindowsSortOrderByHierarchy()`

Установит `canvas.sortOrder` у всех своих кешированных окон с учетом их расположения в иерархии. Этот метод можно вызвать в редакторе через контекстное меню на компоненте менеджера окон.

![image.png](image%206.png)